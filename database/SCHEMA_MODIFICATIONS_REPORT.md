# تقرير إعادة تهيئة ملفات التعديلات (Schema Modifications)

## تم في تاريخ: 4 سبتمبر 2025

### الهدف من إعادة التهيئة:

تنظيم جميع ملفات المهاجرة التي تحتوي على تعديلات الأعمدة (إضافة، تعديل، حذف) في مجموعة موحدة ومنظمة.

### الملفات التي تم إعادة تهيئتها:

#### مجموعة تعديلات الجداول - 9 سبتمبر 2025:

```
1. 2025_09_09_100010_add_missing_columns_to_internal_trucks_table.php
   - إضافة أعمدة warranty_expiry و last_maintenance لجدول internal_trucks

2. 2025_09_09_100011_update_employee_status_default_to_inactive.php
   - تحديث القيمة الافتراضية لحالة الموظف إلى inactive

3. 2025_09_09_100012_add_driving_license_issue_date_to_employees_table.php
   - إضافة عمود تاريخ إصدار رخصة القيادة لجدول الموظفين

4. 2025_09_09_100013_add_additional_documents_to_employees_table.php
   - إضافة أعمدة الوثائق الإضافية لجدول الموظفين

5. 2025_09_09_100014_add_approval_fields_to_equipment_fuel_consumptions_table.php
   - إضافة حقول الموافقة لجدول استهلاك الوقود

6. 2025_09_09_100015_add_category_to_roles_table.php
   - إضافة عمود الفئة لجدول الأدوار

7. 2025_09_09_100016_add_phone_to_users_table.php
   - إضافة عمود الهاتف لجدول المستخدمين

8. 2025_09_09_100017_add_source_to_spare_parts_table.php
   - إضافة عمود المصدر لجدول قطع الغيار

9. 2025_09_09_100018_fix_damaged_parts_receipts_warehouse_foreign_key.php
   - إصلاح المفتاح الخارجي لجدول إيصالات قطع الغيار التالفة

10. 2025_09_09_100019_update_expense_vouchers_add_fields.php
    - تحديث جدول سندات المصروفات وإضافة حقول جديدة

11. 2025_09_09_100020_alter_project_visits_make_visitor_id_nullable.php
    - جعل عمود visitor_id قابل للقيمة الفارغة في جدول زيارات المشاريع

12. 2025_09_09_100021_drop_permissions_json_from_roles_table.php
    - حذف عمود permissions_json من جدول الأدوار

13. 2025_09_09_100022_update_bank_guarantee_type_enum.php
    - تحديث enum نوع الضمان البنكي

14. 2025_09_09_100023_alter_total_with_tax_nullable_in_project_items_table.php
    - جعل عمود total_with_tax قابل للقيمة الفارغة في جدول عناصر المشاريع

15. 2025_09_09_100024_add_fields_to_project_visits_table.php
    - إضافة حقول جديدة لجدول زيارات المشاريع

16. 2025_09_09_100025_add_approval_columns_to_custodies_table.php
    - إضافة أعمدة الموافقة لجدول العهد

17. 2025_09_09_100026_modify_custodies_status_column.php
    - تعديل عمود الحالة في جدول العهد

18. 2025_09_09_100027_update_equipment_movement_history_location_text_columns.php
    - تحديث أعمدة النصوص في جدول تاريخ حركة المعدات

19. 2025_09_09_100028_add_revenue_voucher_id_to_project_extracts.php
    - إضافة معرف سند القبض لجدول مستخلصات المشاريع

20. 2025_09_09_100029_add_tax_fields_to_expense_vouchers.php
    - إضافة حقول الضريبة لجدول سندات المصروفات

21. 2025_09_09_100030_add_tax_fields_to_project_extracts.php
    - إضافة حقول الضريبة لجدول مستخلصات المشاريع

22. 2025_09_09_100031_add_tax_fields_to_revenue_vouchers.php
    - إضافة حقول الضريبة لجدول سندات الإيرادات

23. 2025_09_09_100032_add_daily_rate_to_external_trucks_table.php
    - إضافة عمود الأجر اليومي لجدول الشاحنات الخارجية
```

### التحسينات المطبقة:

#### 1. توحيد التاريخ:

-   ✅ جميع ملفات التعديلات تحمل تاريخ 9 سبتمبر 2025
-   ✅ ترقيم متسلسل من 100010 إلى 100032

#### 2. تنظيم الأسماء:

-   ✅ أسماء واضحة ومفهومة
-   ✅ تصنيف حسب نوع العملية (add, update, alter, drop, modify, fix)
-   ✅ ذكر اسم الجدول المعدل

#### 3. ترتيب منطقي:

-   ✅ الملفات مرتبة تاريخياً وتسلسلياً
-   ✅ التعديلات الأساسية أولاً، ثم التحسينات
-   ✅ إضافة الحقول قبل التعديلات عليها

### إجمالي الإحصائيات:

-   **23 ملف تعديل** تم إعادة تنظيمه
-   **12 جدول مختلف** تم تعديلها
-   **تاريخ موحد**: 2025-09-09
-   **ترقيم متسلسل**: 100010-100032

### أنواع التعديلات:

-   **إضافة أعمدة**: 15 ملف
-   **تحديث قيم**: 4 ملفات
-   **تعديل بنية**: 2 ملف
-   **حذف أعمدة**: 1 ملف
-   **إصلاح مفاتيح**: 1 ملف

### حالة ملفات التعديلات بعد التهيئة:

✅ جميع الملفات منظمة في مجموعة واحدة
✅ ترقيم تسلسلي منطقي ومتسق
✅ أسماء واضحة تصف نوع التعديل
✅ تواريخ موحدة لسهولة الإدارة
✅ جاهزة للتشغيل بالترتيب الصحيح

### التوصيات:

1. ✅ تشغيل هذه الملفات بعد ملفات إنشاء الجداول الأساسية
2. ✅ عمل backup قبل تشغيل أي تعديلات على البنية
3. ✅ اختبار التعديلات في بيئة التطوير أولاً
4. ✅ مراجعة العلاقات بين الجداول بعد التعديلات

### أوامر التشغيل المقترحة:

```bash
# تشغيل المهاجرات الأساسية أولاً
php artisan migrate --path=database/migrations --step

# التحقق من حالة المهاجرة
php artisan migrate:status

# تشغيل ملفات التعديلات
php artisan migrate --path=database/migrations
```
