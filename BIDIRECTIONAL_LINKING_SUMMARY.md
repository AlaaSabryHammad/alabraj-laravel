# ููุฎุต ุงูุชุญุฏูุซุงุช - ุงููุธุงู ุงูุซูุงุฆู ูุฑุจุท ุงููุนุฏุงุช ูุงูุดุงุญูุงุช ุงูุฏุงุฎููุฉ

## โ ุงููููุฒุงุช ุงูููููุฐุฉ

### 1. ุงููุธุงู ุงูุซูุงุฆู ููุฑุจุท ุงูุชููุงุฆู

-   **ูุนุฏุฉ โ ุดุงุญูุฉ ุฏุงุฎููุฉ**: ุนูุฏ ุฅูุดุงุก ูุนุฏุฉ ูู ูุฆุฉ "ุดุงุญูุงุช" ูุชู ุฅูุดุงุก ุดุงุญูุฉ ุฏุงุฎููุฉ ุชููุงุฆูุงู
-   **ุดุงุญูุฉ ุฏุงุฎููุฉ โ ูุนุฏุฉ**: ุนูุฏ ุฅูุดุงุก ุดุงุญูุฉ ุฏุงุฎููุฉ ูุชู ุฅูุดุงุก ูุนุฏุฉ ุชููุงุฆูุงู ูู ุฌุฏูู ุงููุนุฏุงุช
-   **ุงููุฒุงููุฉ**: ุงูุชุญุฏูุซุงุช ุนูู ุฃู ูู ุงูุฌุงูุจูู ุชูุนูุณ ุนูู ุงูุขุฎุฑ

### 2. ุชุญุฏูุซุงุช ุงูููุงุฐุฌ (Models)

#### Equipment Model (`app/Models/Equipment.php`)

```php
protected static function boot()
{
    parent::boot();

    static::created(function ($equipment) {
        // ุนูุฏ ุฅูุดุงุก ูุนุฏุฉ ูู ููุน "ุดุงุญูุงุช" ููุดุฆ ุดุงุญูุฉ ุฏุงุฎููุฉ
        if (($equipment->category == 'ุดุงุญูุงุช' || $equipment->category == 'ุดุงุญูุฉ') && !$equipment->truck_id) {
            // ุงุณุชุฎุฑุงุฌ ุชูุงุตูู ุงูุดุงุญูุฉ ูู ุงุณู ุงููุนุฏุฉ
            $parts = explode(' - ', $equipment->name);
            $plateNumber = count($parts) > 1 ? trim($parts[1]) : 'Unknown';
            $brandModel = trim($parts[0]);

            $brandModelParts = explode(' ', $brandModel);
            $brand = $brandModelParts[0] ?? 'ุบูุฑ ูุญุฏุฏ';
            $model = implode(' ', array_slice($brandModelParts, 1)) ?: 'ุบูุฑ ูุญุฏุฏ';

            $internalTruck = \App\Models\InternalTruck::create([
                'plate_number' => $plateNumber,
                'brand' => $brand,
                'model' => $model,
                'year' => now()->year,
                'load_capacity' => 5.0, // ูููุฉ ุงูุชุฑุงุถูุฉ
                'fuel_type' => 'diesel',
                'status' => $equipment->status == 'in_use' ? 'in_use' : 'available',
                'purchase_date' => $equipment->purchase_date,
                'purchase_price' => $equipment->purchase_price ?? 0,
                'description' => $equipment->description ?? 'ุดุงุญูุฉ ูุญููุฉ ูู ุงููุนุฏุงุช',
                'driver_id' => $equipment->driver_id,
                'user_id' => $equipment->user_id ?? \Illuminate\Support\Facades\Auth::id(),
            ]);

            // ุฑุจุท ุงููุนุฏุฉ ุจุงูุดุงุญูุฉ ุงูุฏุงุฎููุฉ
            $equipment->update(['truck_id' => $internalTruck->id]);
        }
    });
}
```

#### InternalTruck Model (`app/Models/InternalTruck.php`)

```php
protected static function boot()
{
    parent::boot();

    static::created(function ($truck) {
        // ุฅูุดุงุก ูุนุฏุฉ ูุฑุชุจุทุฉ ุนูุฏ ุฅูุดุงุก ุดุงุญูุฉ ุฏุงุฎููุฉ
        \App\Models\Equipment::create([
            'name' => $truck->brand . ' ' . $truck->model . ' - ' . $truck->plate_number,
            'category' => 'ุดุงุญูุงุช',
            'type' => 'ุดุงุญูุฉ ุฏุงุฎููุฉ',
            'model' => $truck->model,
            'manufacturer' => $truck->brand,
            'serial_number' => $truck->chassis_number ?? 'INT-' . $truck->id,
            'status' => $truck->driver_id ? 'in_use' : 'available',
            'purchase_date' => $truck->purchase_date,
            'purchase_price' => $truck->purchase_price ?? 0,
            'description' => 'ุดุงุญูุฉ ุฏุงุฎููุฉ - ุฑูู ุงูููุญุฉ: ' . $truck->plate_number,
            'truck_id' => $truck->id,
            'user_id' => $truck->user_id,
            'driver_id' => $truck->driver_id,
        ]);
    });
}
```

### 3. ุชุญุฏูุซุงุช ุงููุชุญูู (Controller)

#### InternalTruckController

-   **ุฏุงูุฉ index()**: ุชุนุฑุถ ุงููุนุฏุงุช ุบูุฑ ุงููุฑุจูุทุฉ ูู ูุฆุฉ ุดุงุญูุงุช
-   **ุฏุงูุฉ linkEquipment()**: ุชุญูู ุงููุนุฏุฉ ุฅูู ุดุงุญูุฉ ุฏุงุฎููุฉ

```php
public function linkEquipment(Request $request)
{
    $validated = $request->validate([
        'equipment_id' => 'required|exists:equipment,id',
        'fuel_type' => 'nullable|string|in:diesel,gasoline,electric,hybrid'
    ]);

    $equipment = Equipment::findOrFail($validated['equipment_id']);

    // ุงูุชุฃูุฏ ูู ุฃู ุงููุนุฏุฉ ูู ูุฆุฉ ุดุงุญูุงุช ูุบูุฑ ูุฑุจูุทุฉ
    if (!in_array($equipment->category, ['ุดุงุญูุงุช', 'ุดุงุญูุฉ']) || $equipment->truck_id) {
        return redirect()->back()->with('error', 'ูุฐู ุงููุนุฏุฉ ุบูุฑ ูุงุจูุฉ ููุฑุจุท ุฃู ูุฑุชุจุทุฉ ุจุงููุนู');
    }

    // ุฅูุดุงุก ุดุงุญูุฉ ุฏุงุฎููุฉ ูู ุงููุนุฏุฉ
    // ... ููุทู ุงูุชุญููู
}
```

### 4. ุชุญุฏูุซุงุช ุงูุนุฑุถ (Views)

#### ุตูุญุฉ ุงูุดุงุญูุงุช ุงูุฏุงุฎููุฉ (`resources/views/internal-trucks/index.blade.php`)

-   ุฅุถุงูุฉ ูุณู "ูุนุฏุงุช ุดุงุญูุงุช ุบูุฑ ูุฑุจูุทุฉ"
-   ุนุฑุถ ุงููุนุฏุงุช ุงูุชู ูุง ุชููู truck_id
-   ุฒุฑ "ุชุญููู ูุดุงุญูุฉ" ููู ูุนุฏุฉ ุบูุฑ ูุฑุจูุทุฉ

### 5. ุงูุทุฑู (Routes)

```php
Route::post('/internal-trucks/link-equipment', [InternalTruckController::class, 'linkEquipment'])
     ->name('internal-trucks.link-equipment');
```

## ๐ ููู ูุนูู ุงููุธุงู

### ุงูุณููุงุฑูู 1: ุฅูุดุงุก ูุนุฏุฉ ุดุงุญูุฉ

1. ุงููุณุชุฎุฏู ููุดุฆ ูุนุฏุฉ ุฌุฏูุฏุฉ ููุญุฏุฏ ุงููุฆุฉ = "ุดุงุญูุงุช"
2. ุชููุงุฆูุงู ูุชู ุฅูุดุงุก ุดุงุญูุฉ ุฏุงุฎููุฉ ูุฑุชุจุทุฉ
3. ุงููุนุฏุฉ ุชุญุตู ุนูู truck_id ูุดูุฑ ููุดุงุญูุฉ ุงูุฏุงุฎููุฉ

### ุงูุณููุงุฑูู 2: ุฅูุดุงุก ุดุงุญูุฉ ุฏุงุฎููุฉ

1. ุงููุณุชุฎุฏู ููุดุฆ ุดุงุญูุฉ ุฏุงุฎููุฉ ุฌุฏูุฏุฉ
2. ุชููุงุฆูุงู ูุชู ุฅูุดุงุก ูุนุฏุฉ ูุฑุชุจุทุฉ ุจูุฆุฉ "ุดุงุญูุงุช"
3. ุงูุดุงุญูุฉ ูุงููุนุฏุฉ ูุฑุชุจุทุชุงู ุซูุงุฆูุงู

### ุงูุณููุงุฑูู 3: ูุนุฏุฉ ุดุงุญูุฉ ููุฌูุฏุฉ ุบูุฑ ูุฑุจูุทุฉ

1. ุชุธูุฑ ูู ุตูุญุฉ ุงูุดุงุญูุงุช ุงูุฏุงุฎููุฉ ูู ูุณู ูููุตู
2. ูููู ุชุญููููุง ูุดุงุญูุฉ ุฏุงุฎููุฉ ุจุงูููุฑ ุนูู "ุชุญููู ูุดุงุญูุฉ"
3. ูุชู ุฅูุดุงุก ุงูุดุงุญูุฉ ุงูุฏุงุฎููุฉ ูุฑุจุทูุง ุจุงููุนุฏุฉ

## ๐งช ุงูุงุฎุชุจุงุฑุงุช ุงููููุฐุฉ

### ุงุฎุชุจุงุฑุงุช ุงููุธุงู:

-   โ `test_equipment_to_truck.php`: ุงุฎุชุจุงุฑ ุชุญููู ูุนุฏุฉ ูุดุงุญูุฉ
-   โ `test_truck_to_equipment.php`: ุงุฎุชุจุงุฑ ุฅูุดุงุก ูุนุฏุฉ ูู ุดุงุญูุฉ
-   โ `test_final_system.php`: ุงุฎุชุจุงุฑ ุณุฑูุน ูููุธุงู ุงูุซูุงุฆู
-   โ `test_unlinked_equipments.php`: ุงุฎุชุจุงุฑ ุงููุนุฏุงุช ุบูุฑ ุงููุฑุจูุทุฉ

## ๐ง ูุนูููุงุช ุชูููุฉ

### ูุงุนุฏุฉ ุงูุจูุงูุงุช:

-   ุฌุฏูู `equipment`: ูุญุชูู ุนูู ุญูู `truck_id` ููุฑุจุท
-   ุฌุฏูู `internal_trucks`: ุงูุดุงุญูุงุช ุงูุฏุงุฎููุฉ
-   ุงูุนูุงูุฉ: One-to-One ุจูู Equipment ู InternalTruck

### ุงูุฃุญุฏุงุซ ุงููุณุชุฎุฏูุฉ:

-   `Model::created()`: ุนูุฏ ุฅูุดุงุก ุณุฌู ุฌุฏูุฏ
-   `Model::updated()`: ุนูุฏ ุชุญุฏูุซ ุณุฌู (ูููุฒุงููุฉ)
-   `Model::deleted()`: ุนูุฏ ุญุฐู ุณุฌู (ููุชูุธูู)

## โจ ุงููููุฒุงุช ุงูุฅุถุงููุฉ

1. **ููุน ุงูุชูุฑุงุฑ**: ุงููุธุงู ูุชุญูู ูู ูุฌูุฏ ุงูุณุฌูุงุช ูุจู ุงูุฅูุดุงุก
2. **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**: ุงูุชุนุงูู ูุน ุงููููุฏ ูุงูุฃุฎุทุงุก ุงููุญุชููุฉ
3. **ูุงุฌูุฉ ุณููุฉ**: ุนุฑุถ ุงููุนุฏุงุช ุบูุฑ ุงููุฑุจูุทุฉ ูุน ุฎูุงุฑ ุงูุชุญููู
4. **ูุฑููุฉ ุงูุจูุงูุงุช**: ุงุณุชุฎุฑุงุฌ ุชูุงุตูู ุงูุดุงุญูุฉ ูู ุฃุณูุงุก ุงููุนุฏุงุช

ุงูุขู ุงููุธุงู ูุนูู ุจุงููุงูู ููุญูู ุงููุชุทูุจ:

> "ุงุฑูุฏ ุนูุฏ ุชุณุฌูู ูู ููุน ุดุงุญูุฉ ูู ุฌุฏูู ุงููุนุฏุงุช ุชุธูุฑ ูุฐู ุงูุดุงุญูุฉ ูู ุตูุญุฉ ุงูุดุงุญูุงุช ุงูุฏุงุฎููุฉ ูุนูุฏูุง ุงุญูุธ ุดุงุญูู ูู ุตูุญุฉ ุงูุดุงุญูุงุช ุงูุฏุงุฎููู ุงุฑูุฏ ุชุณุฌูููุง ูุจุงุดุฑุฉ ูู ุฌุฏูู ุงููุนุฏุงุช ุชุญุช ููุน ุดุงุญูู"
